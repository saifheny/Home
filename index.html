<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>المنصة التعليمية</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
        
        :root { /* --- Light Mode Variables --- */
            --diamond-blue-start: #74b9ff;
            --diamond-blue-end: #0984e3;
            --light-text: #ffffff;
            --dark-text: #2c3e50;
            --danger-red: #e74c3c;
            --background-color: #f0f2f5;
            --surface-color: #ffffff;
            --secondary-text-color: #7f8c8d;
            --border-color: #e0e0e0;
        }

        .dark-mode { /* --- Dark Mode Variables --- */
            --diamond-blue-start: #5a91c8;
            --diamond-blue-end: #086ab8;
            --light-text: #e0e0e0;
            --dark-text: #ecf0f1;
            --background-color: #1a1a2e;
            --surface-color: #16213e;
            --secondary-text-color: #95a5a6;
            --border-color: #2c3e50;
        }

        body, html {
            font-family: 'Cairo', sans-serif;
            margin: 0;
            padding: 0;
            width: 100%;
            overflow-x: hidden; /* Prevents horizontal scroll */
            background-color: var(--background-color);
            color: var(--dark-text);
            transition: background-color 0.3s, color 0.3s;
        }

        .page {
            display: none;
            min-height: 100vh;
            width: 100vw;
            box-sizing: border-box;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .page.active { 
            display: flex;
        }
        
        #student-dashboard-page.active {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }

        .glossy-button {
            padding: 15px;
            font-size: 1.2rem;
            font-weight: 700;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            color: #ffffff; /* Always white text on buttons */
            background: linear-gradient(145deg, var(--diamond-blue-start), var(--diamond-blue-end));
            box-shadow: 0 5px 15px rgba(0, 123, 255, 0.4), inset 0 1px 1px rgba(255, 255, 255, 0.5);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .glossy-button:before { content: ''; position: absolute; top: -50%; left: -50%; width: 20px; height: 200%; background: rgba(255, 255, 255, 0.4); transform: rotate(45deg); transition: all 0.5s ease; }
        .glossy-button:hover:before { left: 150%; }
        .glossy-button:active { transform: translateY(2px); box-shadow: 0 2px 8px rgba(0, 123, 255, 0.5); }

        /* --- Modals & Alerts --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); display: none; justify-content: center; align-items: center; z-index: 1000; animation: fadeIn 0.3s; }
        .modal-overlay.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .modal-box { background: var(--surface-color); padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); text-align: center; width: 90%; max-width: 400px; transform: scale(0.7); animation: pop-in 0.3s forwards; position: relative; color: var(--dark-text); }
        .modal-box h2 { margin-top: 0; color: var(--dark-text); }
        .modal-box .close-btn { position: absolute; top: 10px; left: 15px; font-size: 1.5rem; color: #aaa; cursor: pointer; }
        .modal-box form input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid var(--border-color); border-radius: 50px; box-sizing: border-box; font-size: 1rem; text-align: center; background-color: var(--background-color); color: var(--dark-text); }
        .modal-box form button { width: 100%; }
        @keyframes pop-in { to { transform: scale(1); } }

        /* --- Page 1: Role Selection --- */
        #role-selection-page { background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)), url(https://images.unsplash.com/photo-1509062522246-3755977927d7?q=80&w=2132&auto=format&fit=crop) center/cover; color: #ffffff; text-align: center; }
        .title-3d { font-size: 2.5rem; font-weight: 900; text-shadow: 0 1px #c7c7c7, 0 2px #b6b6b6, 0 3px #a3a3a3, 0 4px 7px rgba(0,0,0,0.6); margin-bottom: 10px; }
        .role-button { width: 80%; max-width: 300px; margin-bottom: 15px; }

        /* --- Pages 2 & 3: Auth Forms --- */
        #student-auth-page, #teacher-auth-page { background: linear-gradient(to bottom, #dfe9f3, var(--background-color)); }
        .dark-mode #student-auth-page, .dark-mode #teacher-auth-page { background: var(--background-color); }
        .auth-form { width: 90%; max-width: 400px; padding: 30px; } .auth-form h2 { text-align: center; color: var(--dark-text); margin-top: 0; } .auth-form input { width: 100%; padding: 14px; margin-bottom: 15px; border: 1px solid var(--border-color); border-radius: 50px; box-sizing: border-box; font-size: 1rem; text-align: center; background-color: var(--surface-color); color: var(--dark-text); }
        .submit-btn { width: 100%; margin-bottom: 10px; } .back-btn { width: 100%; background: #bdc3c7; color: #2c3e50; box-shadow: none; }
        .auth-tabs { display: flex; width: 100%; margin-bottom: 20px; border-radius: 50px; background-color: var(--border-color); padding: 5px; } .tab { flex: 1; padding: 10px; text-align: center; border-radius: 50px; cursor: pointer; font-weight: 700; } .tab.active { background-color: var(--diamond-blue-start); color: white; }
        .auth-form-section { display: none; width: 100%; } .auth-form-section.active { display: block; }

        /* --- Page 4: Teacher Dashboard --- */
        #teacher-dashboard-page { justify-content: flex-start; padding-top: 70px; padding-bottom: 80px; }
        .dashboard-main-header { position: fixed; top: 0; left: 0; right: 0; display: flex; justify-content: space-between; align-items: center; padding: 10px 20px; background-color: var(--surface-color); box-shadow: 0 2px 10px rgba(0,0,0,0.1); z-index: 10; transition: background-color 0.3s; }
        .header-button { background: none; border: none; font-size: 1rem; font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 8px; } .header-button.logout { color: var(--danger-red); } .header-button.edit-profile { color: var(--diamond-blue-end); }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; display: flex; justify-content: space-around; background-color: var(--surface-color); box-shadow: 0 -2px 15px rgba(0,0,0,0.15); padding: 10px 0; border-top-right-radius: 20px; border-top-left-radius: 20px; z-index: 10; transition: background-color 0.3s;}
        .nav-item { display: flex; flex-direction: column; align-items: center; color: var(--secondary-text-color); text-decoration: none; } .nav-item i { font-size: 1.8rem; margin-bottom: 5px; } .nav-item span { font-size: 0.8rem; font-weight: 600; } .nav-item.active { color: var(--diamond-blue-end); }
        .content-area { text-align: center; padding-top: 50px; font-size: 1.5rem; color: #95a5a6; }

        /* --- Page 5: Student Dashboard --- */
        #student-dashboard-page { height: auto; min-height: 100vh; overflow-y: auto; }
        .dashboard-header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; background-color: var(--surface-color); box-shadow: 0 2px 4px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 10; width: 100%; box-sizing: border-box; transition: background-color 0.3s; }
        #student-welcome-msg { margin: 0; text-align: center; font-size: 1.2rem; font-weight: 700; color: var(--dark-text); }
        
        /* 3D Effect for Slider */
        .slider-container { 
            width: 90vw; 
            margin: 25px auto; 
            border-radius: 15px; 
            height: 200px; 
            position: relative; 
            overflow: visible; /* Needed for 3D shadow */
            perspective: 1000px; /* Creates the 3D space */
        }
        .slider-wrapper {
            width: 100%;
            height: 100%;
            border-radius: 15px;
            transform-style: preserve-3d;
            transition: transform 0.5s ease;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2), 0 5px 10px rgba(0,0,0,0.1);
            transform: rotateX(5deg) rotateY(-5deg);
        }
        .slider-container:hover .slider-wrapper {
            transform: rotateX(0) rotateY(0) scale(1.02);
        }
        .slide { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; transition: opacity 0.5s; border-radius: 15px; overflow: hidden; background-color: var(--border-color); } 
        .slide.active { opacity: 1; } 
        .slide img { width: 100%; height: 100%; object-fit: cover; }
        
        .features-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; padding: 20px; width: 100%; box-sizing: border-box; }
        .feature-item { text-align: center; } .feature-item-link { text-decoration: none; color: inherit; } .feature-item .icon-bg { width: 60px; height: 60px; border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; margin: 0 auto 10px; transition: transform 0.3s, box-shadow 0.3s; background-color: var(--surface-color); box-shadow: 0 4px 12px rgba(0,0,0,0.08); } .feature-item-link:hover .icon-bg { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0,0,0,0.15); } .feature-item p { margin: 0; font-size: 0.85rem; font-weight: 600; color: var(--dark-text);}
        
        .separator { 
            grid-column: 1 / -1; height: 3px; margin: 10px 0; background: linear-gradient(90deg, #ff7474, #b3ff74, #74fff8, #7474ff, #ff74f3, #ff7474); background-size: 400% 100%; animation: color-flow 8s linear infinite;
        }
        @keyframes color-flow { 0% { background-position: 0% 50%; } 100% { background-position: 400% 50%; } }
        
        .teachers-section { padding: 0 20px 30px 20px; width: 100%; box-sizing: border-box; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; } .section-header h2 { margin: 0; font-size: 1.4rem; color: var(--dark-text); } .section-header .view-all-btn { color: var(--diamond-blue-end); font-weight: 700; text-decoration: none; font-size: 0.9rem; cursor: pointer; }
        .teachers-list-container { display: flex; overflow-x: auto; gap: 15px; padding-bottom: 15px; -ms-overflow-style: none; scrollbar-width: none; }
        .teachers-list-container::-webkit-scrollbar { display: none; }
        .teacher-card { text-align: center; flex: 0 0 auto; width: 80px; } .teacher-card img { width: 80px; height: 80px; border-radius: 50%; object-fit: cover; border: 3px solid var(--diamond-blue-start); } .teacher-card p { margin: 5px 0 0 0; font-weight: 600; font-size: 0.9rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--dark-text); }

        /* --- Page 6: All Teachers Page --- */
        #all-teachers-page { justify-content: flex-start; padding: 20px; overflow-y: auto; height: auto; box-sizing: border-box; }
        .page-header { width: 100%; display: flex; align-items: center; margin-bottom: 20px; padding-top: 10px;} 
        .page-header .back-icon { font-size: 1.5rem; cursor: pointer; color: var(--dark-text); flex-basis: 40px; } 
        .page-header h1 { flex-grow: 1; text-align: center; margin: 0; color: var(--dark-text); }
        .teachers-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; width: 100%; padding-bottom: 20px; }
        .teachers-grid .teacher-card { width: 100%; }
        .teachers-grid .teacher-card img { width: 100%; height: auto; aspect-ratio: 1 / 1; }
    </style>
</head>
<body>
    <!-- Modals (Hidden by default) -->
    <div id="teacher-edit-modal" class="modal-overlay"> <div class="modal-box"> <i class="fas fa-times close-btn"></i> <h2>تعديل الملف الشخصي</h2> <form id="teacher-edit-form"> <input type="text" id="teacher-edit-name" placeholder="الاسم الكامل" required> <input type="tel" id="teacher-edit-phone" placeholder="رقم الهاتف" required> <input type="text" id="teacher-edit-code" placeholder="الرمز" required> <input type="url" id="teacher-edit-photo" placeholder="رابط الصورة الشخصية" required> <button type="submit" class="glossy-button">حفظ التغييرات</button> </form> </div> </div>
    <div id="student-edit-modal" class="modal-overlay"> <div class="modal-box"> <i class="fas fa-times close-btn"></i> <h2>تعديل الملف الشخصي</h2> <form id="student-edit-form"> <input type="text" id="student-edit-name" placeholder="الاسم" required> <input type="text" id="student-edit-code" placeholder="الرمز" required> <button type="submit" class="glossy-button">حفظ التغييرات</button> </form> </div> </div>
    <div id="custom-alert" class="modal-overlay"> <div class="modal-box"> <p id="alert-message" style="margin: 0 0 20px 0; font-size: 1.1rem; color: var(--dark-text);"></p> <button id="alert-ok" class="glossy-button" style="width: 50%;">حسنًا</button> </div> </div>

    <!-- Page 1: Role Selection -->
    <div id="role-selection-page" class="page active"> <h1 class="title-3d">المنصة التعليمية</h1> <p>مرحباً بك في مستقبل التعليم الرقمي</p> <button onclick="showPage('student-auth-page')" class="role-button glossy-button">أنا طالب</button> <button onclick="showPage('teacher-auth-page')" class="role-button glossy-button">أنا معلم</button> </div>
    
    <!-- Page 2: Student Auth -->
    <div id="student-auth-page" class="page"> <div class="auth-form"> <h2>تسجيل الطالب</h2> <form id="student-auth-form"> <input type="text" id="student-name" placeholder="الاسم" required> <input type="text" id="student-code" placeholder="الرمز" required> <button type="submit" class="submit-btn glossy-button">دخول / إنشاء حساب</button> </form> <button class="back-btn glossy-button" onclick="showPage('role-selection-page')">العودة</button> </div> </div>
    
    <!-- Page 3: Teacher Auth -->
    <div id="teacher-auth-page" class="page"> <div class="auth-form"> <div class="auth-tabs"> <div class="tab active" data-form="register">إنشاء حساب</div> <div class="tab" data-form="login">تسجيل الدخول</div> </div> <div id="teacher-register-form" class="auth-form-section active"> <input type="text" id="teacher-name" placeholder="الاسم الكامل" required> <input type="tel" id="teacher-phone" placeholder="رقم الهاتف" required> <input type="text" id="teacher-code-reg" placeholder="الرمز" required> <input type="url" id="teacher-photo" placeholder="رابط الصورة الشخصية" required> <button id="teacher-register-btn" class="submit-btn glossy-button">إنشاء حساب جديد</button> </div> <div id="teacher-login-form" class="auth-form-section"> <input type="tel" id="teacher-phone-login" placeholder="رقم الهاتف" required> <input type="text" id="teacher-code-login" placeholder="الرمز" required> <button id="teacher-login-btn" class="submit-btn glossy-button">تسجيل الدخول</button> </div> <button class="back-btn glossy-button" onclick="showPage('role-selection-page')">العودة</button> </div> </div>
    
    <!-- Page 4: Teacher Dashboard -->
    <div id="teacher-dashboard-page" class="page"> <header class="dashboard-main-header"> <button id="teacher-edit-profile-btn" class="header-button edit-profile"><i class="fas fa-edit"></i> تعديل الملف الشخصي</button> <button id="teacher-logout-btn" class="header-button logout"><i class="fas fa-sign-out-alt"></i> خروج</button> </header> <div class="content-area"> <p id="teacher-welcome-msg">مرحباً بك!</p> </div> <nav class="bottom-nav"> <a href="#" class="nav-item active"><i class="fas fa-chalkboard"></i><span>كورساتك</span></a> <a href="#" class="nav-item"><i class="fas fa-plus-circle"></i><span>إنشاء كورس</span></a> <a href="#" class="nav-item"><i class="fas fa-users"></i><span>طلابك</span></a> </nav> </div>
    
    <!-- Page 5: Student Dashboard -->
    <div id="student-dashboard-page" class="page"> 
        <header class="dashboard-header"> 
            <button id="student-edit-profile-btn" class="header-button edit-profile"><i class="fas fa-user-edit"></i> تعديل</button> 
            <h3 id="student-welcome-msg"></h3> 
            <button id="student-logout-btn" class="header-button logout"><i class="fas fa-sign-out-alt"></i> خروج</button> 
        </header> 
        <main style="width: 100%; overflow-y: auto; flex-grow: 1; display: flex; flex-direction: column; align-items: center;"> 
            <section class="slider-container">
                <div id="slider-wrapper" class="slider-wrapper"></div>
            </section> 
            <section class="teachers-section"> 
                <div class="section-header"> 
                    <h2>المعلمين</h2> 
                    <a id="view-all-teachers-btn" class="view-all-btn">الكل <i class="fas fa-arrow-left"></i></a> 
                </div> 
                <div id="teachers-list-container" class="teachers-list-container"></div> 
            </section> 
            <section class="features-grid" id="features-grid"></section> 
        </main> 
    </div>
    
    <!-- Page 6: All Teachers Page (New) -->
    <div id="all-teachers-page" class="page"> 
        <header class="page-header"> 
            <i class="fas fa-arrow-right back-icon" onclick="showPage('student-dashboard-page')"></i> 
            <h1>كل المعلمين</h1> 
            <div style="flex-basis: 40px;"></div> <!-- Spacer --> 
        </header> 
        <div id="all-teachers-grid" class="teachers-grid"></div> 
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <script>
        // --- Automatic Theme (Light/Dark) ---
        function applyTheme() {
            const currentHour = new Date().getHours();
            // Night time is between 7 PM (19) and 6 AM (5)
            if (currentHour >= 19 || currentHour <= 5) {
                document.body.classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
            }
        }

        // --- Firebase Config ---
        const firebaseConfig = { apiKey: "AIzaSyCsnZdFrg-KlWFc0z6OgmXgBp6lPKf14fU", authDomain: "saifsa-b51f1.firebaseapp.com", databaseURL: "https://saifsa-b51f1-default-rtdb.europe-west1.firebasedatabase.app", projectId: "saifsa-b51f1", storageBucket: "saifsa-b51f1.appspot.com", messagingSenderId: "41089917871", appId: "1:41089917871:web:fce49f6f23bd4f679b055a", measurementId: "G-4K733KS3CP" };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const studentsRef = database.ref('students');
        const teachersRef = database.ref('teachers');

        // --- UI & Modal Controls ---
        function showPage(pageId) { document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.getElementById(pageId).classList.add('active'); }
        function showModal(modalId) { document.getElementById(modalId).classList.add('active'); }
        function hideModals() { document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('active')); }
        document.querySelectorAll('.modal-overlay .close-btn').forEach(btn => btn.addEventListener('click', hideModals));
        function customAlert(message) { document.getElementById('alert-message').textContent = message; showModal('custom-alert'); }
        document.getElementById('alert-ok').addEventListener('click', hideModals);

        // --- Session Management ---
        window.addEventListener('load', () => {
            applyTheme(); // Set theme on page load
            const session = JSON.parse(localStorage.getItem('userSession'));
            if (session) {
                if (session.role === 'student') {
                    updateStudentUI(session.data);
                    loadStudentDashboardContent();
                    showPage('student-dashboard-page');
                } else if (session.role === 'teacher') {
                    updateTeacherUI(session.data);
                    showPage('teacher-dashboard-page');
                }
            } else {
                showPage('role-selection-page');
            }
        });
        function createSession(role, data, id) { localStorage.setItem('userSession', JSON.stringify({ role, data, id })); }
        function destroySession() { localStorage.removeItem('userSession'); window.location.reload(); }
        
        function updateStudentUI(data) { document.getElementById('student-welcome-msg').textContent = `مرحباً ${data.name}`; }
        function updateTeacherUI(data) { document.getElementById('teacher-welcome-msg').textContent = `مرحباً بك يا ${data.name}`; }

        // --- Student Logic ---
        document.getElementById('student-auth-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const name = document.getElementById('student-name').value.trim();
            const code = document.getElementById('student-code').value.trim();
            studentsRef.orderByChild('name').equalTo(name).once('value', snapshot => {
                if (snapshot.exists()) {
                    const studentId = Object.keys(snapshot.val())[0];
                    const studentData = snapshot.val()[studentId];
                    if (studentData.code === code) {
                        createSession('student', studentData, studentId); updateStudentUI(studentData); loadStudentDashboardContent(); showPage('student-dashboard-page');
                    } else { customAlert('الرمز غير صحيح.'); }
                } else {
                    const newStudent = { name, code };
                    const newStudentRef = studentsRef.push(newStudent);
                    createSession('student', newStudent, newStudentRef.key); updateStudentUI(newStudent); loadStudentDashboardContent(); showPage('student-dashboard-page');
                }
            });
        });
        document.getElementById('student-edit-profile-btn').addEventListener('click', () => {
            const session = JSON.parse(localStorage.getItem('userSession'));
            if (session && session.role === 'student') {
                document.getElementById('student-edit-name').value = session.data.name;
                document.getElementById('student-edit-code').value = session.data.code;
                showModal('student-edit-modal');
            }
        });
        document.getElementById('student-edit-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const session = JSON.parse(localStorage.getItem('userSession'));
            const updates = { name: document.getElementById('student-edit-name').value.trim(), code: document.getElementById('student-edit-code').value.trim() };
            studentsRef.child(session.id).update(updates).then(() => {
                createSession('student', updates, session.id); updateStudentUI(updates); hideModals(); customAlert('تم تحديث ملفك الشخصي بنجاح.');
            }).catch(err => customAlert('حدث خطأ: ' + err.message));
        });

        // --- Teacher Logic ---
        document.querySelectorAll('.auth-tabs .tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelector('.tab.active').classList.remove('active'); tab.classList.add('active');
                document.querySelector('.auth-form-section.active').classList.remove('active'); document.getElementById(`teacher-${tab.dataset.form}-form`).classList.add('active');
            });
        });
        document.getElementById('teacher-register-btn').addEventListener('click', () => {
            const name = document.getElementById('teacher-name').value.trim();
            const phone = document.getElementById('teacher-phone').value.trim();
            const code = document.getElementById('teacher-code-reg').value.trim();
            const photo = document.getElementById('teacher-photo').value.trim();
            if(!name || !phone || !code) { customAlert("الرجاء ملء جميع الحقول المطلوبة."); return; }
            teachersRef.orderByChild('phone').equalTo(phone).once('value', snapshot => {
                if(snapshot.exists()) { customAlert("هذا الرقم مسجل بالفعل."); }
                else {
                    const newTeacher = { name, phone, code, photo };
                    const newTeacherRef = teachersRef.push(newTeacher);
                    createSession('teacher', newTeacher, newTeacherRef.key); updateTeacherUI(newTeacher); showPage('teacher-dashboard-page');
                }
            });
        });
        document.getElementById('teacher-login-btn').addEventListener('click', () => {
            const phone = document.getElementById('teacher-phone-login').value.trim();
            const code = document.getElementById('teacher-code-login').value.trim();
            teachersRef.orderByChild('phone').equalTo(phone).once('value', snapshot => {
                if (snapshot.exists()) {
                    const teacherId = Object.keys(snapshot.val())[0];
                    const teacherData = snapshot.val()[teacherId];
                    if (teacherData.code === code) {
                        createSession('teacher', teacherData, teacherId); updateTeacherUI(teacherData); showPage('teacher-dashboard-page');
                    } else { customAlert('الرمز غير صحيح.'); }
                } else { customAlert("رقم الهاتف غير مسجل."); }
            });
        });
        document.getElementById('teacher-edit-profile-btn').addEventListener('click', () => {
            const session = JSON.parse(localStorage.getItem('userSession'));
            if (session && session.role === 'teacher') {
                document.getElementById('teacher-edit-name').value = session.data.name;
                document.getElementById('teacher-edit-phone').value = session.data.phone;
                document.getElementById('teacher-edit-code').value = session.data.code;
                document.getElementById('teacher-edit-photo').value = session.data.photo;
                showModal('teacher-edit-modal');
            }
        });
        document.getElementById('teacher-edit-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const session = JSON.parse(localStorage.getItem('userSession'));
            const updates = { name: document.getElementById('teacher-edit-name').value.trim(), phone: document.getElementById('teacher-edit-phone').value.trim(), code: document.getElementById('teacher-edit-code').value.trim(), photo: document.getElementById('teacher-edit-photo').value.trim() };
            teachersRef.child(session.id).update(updates).then(() => {
                createSession('teacher', updates, session.id); updateTeacherUI(updates); hideModals(); customAlert('تم تحديث ملفك الشخصي بنجاح.');
            }).catch(err => customAlert('حدث خطأ: ' + err.message));
        });

        // --- Student Dashboard Content Loading ---
        function loadStudentDashboardContent() {
            loadTeachersForStudent();
            loadFeaturesGrid();
            loadSlider();
        }
        document.getElementById('teacher-logout-btn').addEventListener('click', destroySession);
        document.getElementById('student-logout-btn').addEventListener('click', destroySession);
        document.getElementById('view-all-teachers-btn').addEventListener('click', (e) => { 
            e.preventDefault(); 
            showPage('all-teachers-page'); 
        });
        
        function loadTeachersForStudent() {
            const listContainer = document.getElementById('teachers-list-container');
            const gridContainer = document.getElementById('all-teachers-grid');
            listContainer.innerHTML = ''; 
            gridContainer.innerHTML = '';
            teachersRef.once('value', snapshot => {
                if (!snapshot.exists()) { 
                    const noTeachersMsg = '<p>لا يوجد معلمين حالياً</p>';
                    listContainer.innerHTML = noTeachersMsg; 
                    gridContainer.innerHTML = noTeachersMsg;
                    return; 
                }
                snapshot.forEach(childSnapshot => {
                    const teacher = childSnapshot.val();
                    const placeholderImg = 'https://via.placeholder.com/80/0984e3/FFFFFF?text=T';
                    const teacherCardHTML = `<div class="teacher-card"><img src="${teacher.photo || placeholderImg}" alt="${teacher.name}" onerror="this.src='${placeholderImg}'"><p>${teacher.name}</p></div>`;
                    listContainer.innerHTML += teacherCardHTML;
                    gridContainer.innerHTML += teacherCardHTML;
                });
            });
        }
        
        function loadSlider() {
            const sliderWrapper = document.getElementById('slider-wrapper');
            const adsRef = database.ref('ads');
            let slideInterval;
            adsRef.on('value', (snapshot) => {
                clearInterval(slideInterval);
                const adsData = snapshot.val();
                if (!adsData) { sliderWrapper.innerHTML = ''; return; }
                const slidesData = Object.values(adsData);
                if (slidesData.length === 0) return;
                
                sliderWrapper.innerHTML = '';
                slidesData.forEach((ad, index) => {
                    const slideElement = document.createElement('div');
                    slideElement.className = 'slide' + (index === 0 ? ' active' : '');
                    const imageElement = document.createElement('img');
                    imageElement.src = ad.imageUrl;
                    slideElement.appendChild(ad.linkUrl ? Object.assign(document.createElement('a'), {href: ad.linkUrl, innerHTML: imageElement.outerHTML}) : imageElement);
                    sliderWrapper.appendChild(slideElement);
                });

                if (slidesData.length > 1) {
                    let currentIndex = 0;
                    slideInterval = setInterval(() => {
                        const slides = sliderWrapper.querySelectorAll('.slide');
                        slides[currentIndex].classList.remove('active');
                        currentIndex = (currentIndex + 1) % slides.length;
                        slides[currentIndex].classList.add('active');
                    }, 4000);
                }
            });
        }
        
        function loadFeaturesGrid() {
            const featuresContainer = document.getElementById('features-grid');
            featuresContainer.innerHTML = `
                <div class="feature-item" data-key="safeAI"><a class="feature-item-link"><div class="icon-bg"><i class="fa-solid fa-shield-halved"></i></div><p>Safe AI</p></a></div>
                <div class="feature-item" data-key="programming"><a class="feature-item-link"><div class="icon-bg"><i class="fa-solid fa-code"></i></div><p>منصة البرمجة</p></a></div>
                <div class="feature-item" data-key="education"><a class="feature-item-link"><div class="icon-bg"><i class="fa-solid fa-graduation-cap"></i></div><p>المنصة التعليمية</p></a></div>
                <div class="separator"></div>
                <div class="feature-item" data-key="xo_game"><a class="feature-item-link"><div class="icon-bg"><i class="fa-solid fa-gamepad"></i></div><p>لعبة XO</p></a></div>
                <div class="feature-item" data-key="cola_game"><a class="feature-item-link"><div class="icon-bg"><i class="fa-solid fa-puzzle-piece"></i></div><p>لعبة حبال الكولا</p></a></div>
                <div class="feature-item" data-key="exams_homework"><a class="feature-item-link"><div class="icon-bg"><i class="fa-solid fa-file-pen"></i></div><p>الاختبارات والواجبات</p></a></div>
                <div class="separator"></div>
                <div class="feature-item" data-key="chat"><a class="feature-item-link"><div class="icon-bg"><i class="fa-solid fa-comments"></i></div><p>الدردشة</p></a></div>
                <div class="feature-item" data-key="kerio"><a class="feature-item-link"><div class="icon-bg"><i class="fa-solid fa-laptop-file"></i></div><p>حل منصة كيريو</p></a></div>
                <div class="feature-item" data-key="shorts"><a class="feature-item-link"><div class="icon-bg"><i class="fa-solid fa-photo-film"></i></div><p>الفيديوهات الشورتس</p></a></div>
            `;
            const categoriesRef = database.ref('categories');
            categoriesRef.on('value', (snapshot) => {
                const links = snapshot.val();
                if (!links) return;
                featuresContainer.querySelectorAll('.feature-item-link').forEach(link => {
                    const key = link.parentElement.dataset.key;
                    if(links[key]) link.href = links[key];
                });
            });
        }
    </script>
</body>
</html>
